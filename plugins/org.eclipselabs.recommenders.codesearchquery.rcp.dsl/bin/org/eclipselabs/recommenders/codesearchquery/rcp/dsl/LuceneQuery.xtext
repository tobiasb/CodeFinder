grammar org.eclipselabs.recommenders.codesearchquery.rcp.dsl.LuceneQuery 
	with org.eclipse.xtext.common.Terminals//org.eclipse.xtext.xbase.Xtype

generate luceneQuery 'http://www.eclipselabs.org/recommenders/codesearchquery/rcp/dsl/LuceneQuery'


/* * 
 *   Query  ::= ( Clause )*
 *   Clause ::= ["+", "-"] [<TERM> ":"] ( <TERM> | "(" Query ")" )
 * */
 
	Exp1 returns Expression:
	 Exp2 ( {Exp1.left=current} b=BinaryExp? right=Exp1 )?; // Right associativity. Why? See http://blog.efftinge.de/2010/08/parsing-expressions-with-xtext.html
	
	Exp2 returns Expression:
	 value=ClauseExpression | (UnaryExpression? '(' Exp1 ')');
	 
/*
	The following rules are generated. Do not modify. Modify source file instead.
*/
	ClauseExpression:
		(UnaryExpression)? 
		(
			default=SimpleFieldValue | // Default field
			(
				(
					field=SimpleField ':' 
					(
						(values+=SimpleFieldValue)
						| ('('(UnaryExpression? values+=SimpleFieldValue)*')')
					)
				)
			| 	(
					field=TypeField ':' 
					(
						(values+=TypeFieldValue)
						| ('('(UnaryExpression? values+=TypeFieldValue)*')')
					)
				)
			| 	(
					field=MethodField ':' 
					(
						(values+=MethodFieldValue)
						| ('('(UnaryExpression? values+=MethodFieldValue)*')')
					)
				)
			| 	(
					field=FilePathField ':' 
					(
						(values+=FilePathFieldValue)
						| ('('(UnaryExpression? values+=FilePathFieldValue)*')')
					)
				)
			| 	(
					field=NumberField ':' 
					(
						(values+=NumberFieldValue)
						| ('('(UnaryExpression? values+=NumberFieldValue)*')')
					)
				)
			| 	(
					field=ModifierField ':' 
					(
						(values+=ModifierFieldValue)
						| ('('(UnaryExpression? values+=ModifierFieldValue)*')')
					)
				)
			| 	(
					field=TimeField ':' 
					(
						(values+=TimeFieldValue)
						| ('('(UnaryExpression? values+=TimeFieldValue)*')')
					)
				)
			| 	(
					field=DocumentTypeField ':' 
					(
						(values+=DocumentTypeFieldValue)
						| ('('(UnaryExpression? values+=DocumentTypeFieldValue)*')')
					)
				)
			| 	(
					field=ProjectNameField ':' 
					(
						(values+=ProjectNameFieldValue)
						| ('('(UnaryExpression? values+=ProjectNameFieldValue)*')')
					)
				)
			| 	(
					field=AnnotationField ':' 
					(
						(values+=AnnotationFieldValue)
						| ('('(UnaryExpression? values+=AnnotationFieldValue)*')')
					)
				)
			)
		)
	;

	SimpleField:
			FullyQualifiedName='FullyQualifiedName'
		| 	FriendlyName='FriendlyName'
		| 	DeclaredMethods='DeclaredMethods'
		| 	ReturnVariableEexpressions='ReturnVariableEexpressions'
		| 	AllDeclaredMethodNames='AllDeclaredMethodNames'
		| 	DeclaredMethodNames='DeclaredMethodNames'
		| 	DeclaredFieldNames='DeclaredFieldNames'
		| 	AllDeclaredFieldNames='AllDeclaredFieldNames'
		| 	FullText='FullText'
		| 	FieldsRead='FieldsRead'
		| 	FieldsWritten='FieldsWritten'
		| 	UsedFieldsInFinally='UsedFieldsInFinally'
		| 	UsedFieldsInTry='UsedFieldsInTry'
	;
	
	TypeField:
			ImplementedTypes='ImplementedTypes'
		| 	ExtendedTypes='ExtendedTypes'
		| 	UsedTypes='UsedTypes'
		| 	UsedTypesInTry='UsedTypesInTry'
		| 	UsedTypesInFinally='UsedTypesInFinally'
		| 	ParameterTypes='ParameterTypes'
		| 	ReturnType='ReturnType'
		| 	InstanceofTypes='InstanceofTypes'
		| 	AllImplementedTypes='AllImplementedTypes'
		| 	AllExtendedTypes='AllExtendedTypes'
		| 	FieldType='FieldType'
		| 	CaughtType='CaughtType'
		| 	DeclaredFieldTypes='DeclaredFieldTypes'
		| 	DeclaringType='DeclaringType'
	;
	
	MethodField:
			UsedMethods='UsedMethods'
		| 	UsedMethodsInTry='UsedMethodsInTry'
		| 	UsedMethodsInFinally='UsedMethodsInFinally'
		| 	OverriddenMethods='OverriddenMethods'
	;
	
	FilePathField:
			ResourcePath='ResourcePath'
	;
	
	NumberField:
			ParameterCount='ParameterCount'
	;
	
	ModifierField:
			Modifiers='Modifiers'
	;
	
	TimeField:
			Timestamp='Timestamp'
	;
	
	DocumentTypeField:
			Type='Type'
	;
	
	ProjectNameField:
			ProjectName='ProjectName'
	;
	
	AnnotationField:
			Annotations='Annotations'
	;
	
	/*
	End of generated rules.
	*/
		

	SimpleFieldValue:
		NameWithWC
	;
	
	MethodFieldValue:
		NameWithWC
	;
	
	ProjectNameFieldValue:
		NameWithWC
	;
	
	NumberFieldValue:
		INT
	;
	
	ModifierFieldValue:
		'private'
		| 'public' 
		| 'static' 
		| 'final'
		| 'abstract' 
		| 'protected'
	;
	
	TimeFieldValue:
		NameWithWC
	;
	
	DocumentTypeFieldValue:
		'class'
		| 'method'
		| 'field'
		| 'trycatch'
	;
	
	AnnotationFieldValue:
		NameWithWC
	;
	
	TypeFieldValue:
		NameWithWC
	;
	
	enum BinaryExp:
		and1='AND' | or1='OR' | or2='||'
	;

	UnaryExpression:
		('-' | 'NOT' | '!' | '+')
	;
	
	terminal NameWithWC		: ('a'..'z'|'A'..'Z'|'_'|'*'|'?'|'<'|'>'|'['|']') ('a'..'z'|'A'..'Z'|'_'|'0'..'9'|'*'|'?'|'<'|'>'|'['|']'|'.')*;
	terminal PathWithWC  	: (('A'..'Z' ':') | ('a'..'z'|'A'..'Z'|'_'|'/')) ('a'..'z'|'A'..'Z'|'_'|'0'..'9'|'*'|'?'|'.'|'/')*;
	
	FilePathFieldValue:
		PathWithWC
	;
	//-----------------

